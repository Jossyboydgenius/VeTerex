generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                 String        @id @default(cuid())
  verychatId         String?       @unique
  wepinId            String?       @unique
  profileName        String
  profileImage       String?
  bio                String?
  email              String?       @unique
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  walletPasswordHash String?
  media              Media[]
  transactions       Transaction[]
  wallets            Wallet[]

  @@index([verychatId])
  @@index([wepinId])
}

model Wallet {
  id            String   @id @default(cuid())
  userId        String
  walletAddress String   @unique
  network       String   @default("verychain")
  chainId       Int      @default(4613)
  balance       Float    @default(0)
  nftCount      Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([walletAddress])
}

model Transaction {
  id          String   @id @default(cuid())
  userId      String
  fromAddress String
  toAddress   String
  amount      Float
  txHash      String   @unique
  status      String   @default("pending")
  tokenId     String?
  mediaType   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([txHash])
  @@index([status])
}

model Media {
  id          String   @id @default(cuid())
  userId      String
  fileName    String
  fileUrl     String
  fileType    String
  fileSize    Int
  storagePath String
  purpose     String   @default("upload")
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([purpose])
}
